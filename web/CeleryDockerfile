FROM python:3.6
ENV PYTHONUNBUFFERED 1
RUN mkdir -p perfserv/code
RUN mkdir perfserv/uploads
WORKDIR perfserv/code
ADD requirements.txt ./
RUN pip install -r requirements.txt
RUN groupadd -r celery && useradd -r -g celery celery
RUN groupadd -r docker && usermod -a -G docker celery
RUN mkdir /home/celery/
RUN mkdir /home/celery/.ssh
RUN chown celery:celery -R /home/celery/
ADD id_rsa.pub /home/celery/.ssh/id_rsa.pub
ADD id_rsa /home/celery/.ssh/id_rsa
RUN chown celery:celery -R /home/celery/.ssh
ADD . /home/celery
RUN chown celery:celery -R /home/celery
RUN chown celery:celery -R /perfserv/uploads
WORKDIR /home/celery
# USER celery
RUN chmod 400 /home/celery/.ssh/id_rsa
